;(self.SPZ=self.SPZ||[]).push({n:"spz-interact-observer",ev:"0.1",l:!0,v:"1.0",m:0,f:function(t,i){!function(){var i=Object.prototype;function e(t){return"{}"===JSON.stringify(t)}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function o(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function s(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,i){return(u=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function a(t,i){return!i||"object"!==n(i)&&"function"!=typeof i?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):i}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i.hasOwnProperty,i.toString;var h="spz-interact-observer",c="scroll",f={BOTTOM:"bottom",TOP:"top"},v=function(t){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&u(t,i)}(m,t);var i,n,v,d,y,b=(d=m,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,i=l(d);if(y){var e=l(this).constructor;t=Reflect.construct(i,arguments,e)}else t=i.apply(this,arguments);return a(this,t)});function m(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,m),(i=b.call(this,t)).interact_=c;var e=SPZServices.platformFor(i.win);return i.isIos_=e.isIos(),i.isSafari_=e.isSafari(),i}return i=m,v=[{key:"deferredMount",value:function(){return!1}}],(n=[{key:"buildCallback",value:function(){this.action_=SPZServices.actionServiceForDoc(this.element),this.targetElement_=document.getElementById(this.element.getAttribute("target-id")),this.element.hasAttribute("interact")&&(this.interact_=this.element.getAttribute("interact")),this.element.hasAttribute("from")&&this.assert(this.animateFrom_=this.element.getAttribute("from"),'"to" attribute required %s',h),this.element.hasAttribute("to")&&this.assert(this.animateTo_=this.element.getAttribute("to"),'"to" attribute required %s',h),this.animateTo_=this.handleStyle_(this.animateTo_),this.animateFrom_=this.handleStyle_(this.animateFrom_),this.smoothness_=this.element.getAttribute("smoothness")||30,this.targetElement_&&(this.interact_!==c?this.initMousemove_():this.initScroll_())}},{key:"initScroll_",value:function(){var t;this.position_=null===(t=this.animateTo_)||void 0===t?void 0:t.position,[f.BOTTOM,f.TOP].includes(this.position_)||this.element.hasAttribute("observe-id")||this.element.hasAttribute("rely-id")?this.initScrollStick_():e(this.animateFrom_)&&e(this.animateTo_)?this.initScrollUser_():this.initScrollParallax_()}},{key:"initMousemove_",value:function(){var t=this,i=this.targetElement_;SPZUtils.Event.listen(this.targetElement_,"mouseover",(function(){SPZCore.Dom.toggleAttribute(t.targetElement_,"mouse-in",!0),t.unListenMousemove_=SPZUtils.Event.listen(t.targetElement_,"mousemove",(function(e){var n=t.calcHoveStyle_(e);t.element.hasAttribute("observe-id")&&(i=document.getElementById(t.element.getAttribute("observe-id")),n=t.calcObserveHoveStyle_(e));var r="translate3d(".concat(n.translateX||0,"px, ").concat(n.translateX||0,"px, ").concat(n.translateZ||0,"px)")+" rotateX("+(n.rotateX?n.rotateX:0)+"deg) rotateY("+(n.rotateY?n.rotateY:0)+"deg) rotateZ("+(n.rotateZ?n.rotateZ:0)+"deg)";SPZCore.Dom.setStyle(i,"transform",r)}))})),SPZUtils.Event.listen(this.targetElement_,"mouseout",(function(){SPZCore.Dom.toggleAttribute(t.targetElement_,"mouse-in",!1),t.unListenMousemove_(),SPZCore.Dom.setStyle(i,"transform","none")}))}},{key:"initScrollParallax_",value:function(){var t=this;this.getSpzDoc().whenFirstVisible().then((function(){t.onScrollParallax_(!0)}))}},{key:"onScrollParallax_",value:function(){var t=document.body.scrollTop||document.documentElement.scrollTop,i=document.documentElement.clientHeight,e=Math.max(0,this.getOffsetPosition_(this.element)-i),n=e+i,r=Math.min(Math.max(t,e),n);this.calcProperties_(r,e,n),this.initRequestAnimation_()}},{key:"calcProperties_",value:function(t,i,e){var n=this,r=!1,o=[];if(Object.keys(this.animateFrom_).forEach((function(s){var u=n.animateTo_[s],a=0;"scaleX"!=s&&"scaleY"!=s||(a=n.animateFrom_[s]);var l=Number(n.element.getAttribute("_".concat(s)));l||(l=a);var h=(t-i)/(e-i)*(u-a)+a,c=l+(h-l)/n.smoothness_;(c=Math.ceil(1e3*c)/1e3)==l&&h==u&&(c=u),o[s]||(o[s]=0),o[s]+=c,l!=o[s]&&(n.element.setAttribute("_".concat(s),o[s]),r=!0)})),r){var s,u;o.scaleX||(o.scaleX=(null===(s=this.animateFrom_)||void 0===s?void 0:s.scaleX)||1),o.scaleY||(o.scaleY=(null===(u=this.animateFrom_)||void 0===u?void 0:u.scaleY)||1);var a="translate3d(".concat(o.translateX||0,"px, ").concat(o.translateY||0,"px, ").concat(o.translateZ||0,"px)")+" "+"scaleX(".concat(o.scaleX,") scaleY(").concat(o.scaleY,")");SPZCore.Dom.setStyle(this.targetElement_,"transform",a)}}},{key:"initScrollUser_",value:function(){var t=this,i=null,e=this.element.getAttribute("distance")||this.targetElement_.clientHeight;this.element.hasAttribute("rely-offsetTop")&&(e=this.getOffsetPosition_(this.targetElement_)),this.userFrom_=this.handleAttr_(this.element.getAttribute("from")),this.getViewport().onScroll((function(){t.userTo_=t.handleAttr_(t.element.getAttribute("to"));var n=(document.body.scrollTop||document.documentElement.scrollTop)-e;null!==i&&i===n>=0||t.toggle_(n>=0),i=n>=0}))}},{key:"initScrollStick_",value:function(){var t=this;if(this.hasEntryShow_=this.element.hasAttribute("entry-show"),this.position_=this.position_||"top",this.element.hasAttribute("observe-id")||this.element.hasAttribute("rely-id")){var i=document.getElementById(this.element.getAttribute("observe-id")||this.element.getAttribute("rely-id"));this.registerAction("change",(function(i){return t.initPosition_(i.source,!0,!0)}));var e=!1;return new(self.MutationObserver||self.WebKitMutationObserver)((function(){t.initPosition_(i,e)})).observe(i,{childList:!0,subtree:!0}),void SPZCore.observeIntersections(i,(function(n){e=n.isIntersecting,t.initPosition_(i,n.isIntersecting)}))}this.isIos_&&this.isSafari_&&this.position_===f.BOTTOM&&this.compensateIosBottombar_(),this.registerAction("stickyChange",(function(){var i=t.getEleListAndDistance_().distance;SPZCore.Dom.setStyles(t.element,o({},t.position_,"".concat(i,"px")))}));var n=this.getEleListAndDistance_().distance;SPZCore.observeIntersections(this.targetElement_,(function(i){t.handleScrollStick_(i)}),{rootMargin:"-".concat(n,"px")})}},{key:"handleScrollStick_",value:function(t){var i=t.boundingClientRect,e=t.isIntersecting,n=this.getEleListAndDistance_(),r=n.distance,s=n.eleList,u=this.win.document.documentElement,a=u.clientHeight,l=u.scrollTop,h=this.getOffsetPosition_(this.targetElement_),c=a<i.y&&!this.hasEntryShow_&&this.initEntry_,f=e||c;this.setInitStatus_(!f),this.setElementVisible_(this.element,!f),this.setTargetPosition_(this.element,h+r>=l+a),f||(SPZCore.Dom.setStyles(this.element,o({},this.position_,"".concat(r,"px"))),this.handleObserverList_(s))}},{key:"setInitStatus_",value:function(t){this.initEntry_=t}},{key:"compensateIosBottombar_",value:function(){if(!this.bottomBarCompensated_){var t=this.win.document.createElement("div");SPZCore.Dom.setStyles(t,{"height":"54px","width":"100%","background-color":"transparent"}),t.classList.add("ios_safari_bottombar"),this.element.appendChild(t),this.bottomBarCompensated_=!0}}},{key:"initPosition_",value:function(t,i){var e=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.element.hasAttribute("rely-sticky")||this.isStickyElement_(t)||n){null==this.originTop_&&(this.originTop_=parseFloat(SPZCore.Dom.computedStyle(this.win,this.targetElement_)[this.position_])||0),n&&(t=document.getElementById(this.element.getAttribute("observe-id")||this.element.getAttribute("rely-id")));var r=t.clientHeight;this.isStickyElement_(t)&&(r+=parseFloat(SPZCore.Dom.computedStyle(this.win,t)[this.position_])||0);var s="".concat(i?r+this.originTop_:this.originTop_,"px");this.mutateElement((function(){SPZCore.Dom.setStyles(e.targetElement_,o({},e.position_,s));var t="change",i=SPZUtils.Event.create(e.win,"spz-interact-observer.".concat(t),{});n&&e.action_.trigger(e.element,t,i)}))}}},{key:"setTargetPosition_",value:function(t,i){SPZCore.Dom.toggleAttribute(t,"top",i),SPZCore.Dom.toggleAttribute(t,"bottom",!i)}},{key:"setElementVisible_",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.classList.remove(i?"hide":"show"),t.classList.add(i?"show":"hide")}},{key:"getEleListAndDistance_",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=this.findElement_(this.getElementByPosition_(t+5)),r=i&&(null==n?void 0:n.compareDocumentPosition(i));return n&&(!i||r&&16!==r&&8!==r)&&null!=n&&n.compareDocumentPosition(this.element)?(e.includes(n)||e.push(n),t+=this.getHeight_(n),this.getEleListAndDistance_(t,n,e)):{distance:t,eleList:e}}},{key:"handleObserverList_",value:function(t){var i=this;t.forEach((function(t){SPZCore.observeIntersections(t,(function(){SPZCore.Dom.setStyles(i.element,o({},i.position_,"".concat(i.getEleListAndDistance_().distance,"px")))}),{rootMargin:"50% 31.25%"})}))}},{key:"getHeight_",value:function(t){return parseFloat(SPZCore.Dom.computedStyle(this.win,t).height)}},{key:"getElementByPosition_",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:parseInt(SPZCore.Dom.computedStyle(this.win,document.body).marginLeft,10)+1;return this.elementFromViewportPoint_(i,this.position_===f.BOTTOM?this.getViewport().getSize().height-t:t)}},{key:"findElement_",value:function(t){if(!t)return null;if(this.isStickyElement_(t))return t;for(var i=t.parentNode;i;){if(this.isStickyElement_(i))return i;i=i.parentNode}return null}},{key:"isStickyElement_",value:function(t){if(!t||"#document"===t.nodeName)return!1;var i=SPZCore.Dom.computedStyle(this.win,t),e=i.bottom,n=i.position,r=i.top;return!("sticky"!==n&&"fixed"!==n||this.isAutoAttributes_(r)&&this.isAutoAttributes_(e))}},{key:"isAutoAttributes_",value:function(t){return"auto"===t}},{key:"elementFromViewportPoint_",value:function(t,i){if(this.elementFromPointIsUsingViewPortCoordinates_())return window.document.elementFromPoint(t,i);var e=this.viewportCoordinateToDocumentCoordinate_(t,i);return window.document.elementFromPoint(e.x,e.y)}},{key:"elementFromPointIsUsingViewPortCoordinates_",value:function(){var t=this.getViewport().getScrollTop(),i=this.getViewport().getSize().height;return t>0&&null===window.document.elementFromPoint(0,t+i-1)}},{key:"viewportCoordinateToDocumentCoordinate_",value:function(t,i){var e=new Object;return e.x=t+this.win.pageXOffset,e.y=i+this.win.pageYOffset,e}},{key:"getOffsetPosition_",value:function(t){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"offsetTop",e=t[i],n=t.offsetParent;null!==n;)e+=n[i],n=n.offsetParent;return e}},{key:"initRequestAnimation_",value:function(){var t=this;(this.win.requestAnimationFrame||this.win.webkitRequestAnimationFrame||this.win.mozRequestAnimationFrame||this.win.oRequestAnimationFrame||this.win.msRequestAnimationFrame)((function(){t.onScrollParallax_(!1)}))}},{key:"calculatePercentage_",value:function(t,i){return-2/i*t+1}},{key:"calcHoveStyle_",value:function(t){var i=this,e=this.getOffsetPosition_(this.targetElement_,"offsetLeft"),n=this.getOffsetPosition_(this.targetElement_),r=this.targetElement_.clientWidth,o=this.targetElement_.clientHeight,s=(t.clientX||t.touches[0].pageX)-e,u=(t.clientY||t.touches[0].pageY)-n,a={translateX:this.calculatePercentage_(s,r),translateY:this.calculatePercentage_(u,o),rotateX:this.calculatePercentage_(u,o),rotateY:-1*this.calculatePercentage_(s,r)};return Object.keys(a).forEach((function(t){var e=i.animateTo_[t];i.animateTo_[t]?a[t]=-1*e*a[t]:a[t]=0})),a}},{key:"calcObserveHoveStyle_",value:function(t){var i=t.clientX||t.touches[0].pageX,e=t.clientY||t.touches[0].pageY,n=t.target.getBoundingClientRect(),r=n.height,o=n.left,s=n.top,u=o+n.width/2-i,a=s+r/2-e,l=Math.atan2(u,a),h=Math.sqrt(u*u,a*a);return{translateX:-Math.sin(l)*h/8,translateY:Math.cos(l)*h/8}}},{key:"toggle_",value:function(t){var i,e;null===(i=t?this.userTo_:this.userFrom_)||void 0===i||i.forEach((function(t){var i=t.attr,e=t.ele;e&&SPZCore.Dom.toggleAttribute(e,i,!0)})),null===(e=t?this.userFrom_:this.userTo_)||void 0===e||e.forEach((function(t){var i=t.attr,e=t.ele;e&&SPZCore.Dom.toggleAttribute(e,i,!1)}))}},{key:"handleAttr_",value:function(t){var i,e;return null==t||null===(i=t.split(";"))||void 0===i||null===(e=i.filter((function(t){return t})))||void 0===e?void 0:e.map((function(t){var i=t.split(".").filter((function(t){return t}));return{ele:document.getElementById(i[0]),attr:i[1]}}))}},{key:"handleStyle_",value:function(t){var i,e,n={};return null==t||null===(i=t.split(";"))||void 0===i||null===(e=i.filter((function(t){return t})))||void 0===e||e.forEach((function(t){var i,e=(2,function(t){if(Array.isArray(t))return t}(i=t.split(":"))||function(t,i){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=e){var n,r,o=[],s=!0,u=!1;try{for(e=e.call(t);!(s=(n=e.next()).done)&&(o.push(n.value),2!==o.length);s=!0);}catch(t){u=!0,r=t}finally{try{s||null==e.return||e.return()}finally{if(u)throw r}}return o}}(i)||function(t,i){if(t){if("string"==typeof t)return r(t,2);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,2):void 0}}(i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=e[0],s=e[1];n[o]=parseFloat(s)||s})),n}},{key:"isLayoutSupported",value:function(){return!0}}])&&s(i.prototype,n),v&&s(i,v),m}(t.BaseElement);self.SPZ.registerElement(h,v)}()}});